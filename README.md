# MyRecord

demand:
- 能添加记录
  - 添加记录内容
    - markdown
    - 支持文件
      - 支持图片, 其他等文件
      - 支持md5缓存
    - 支持引用其他的记录
      - 该引用会在显示的时候被提取出来集中显示
  - 添加记录标签
    - 支持选择与添加
    - 哪怕不添加也会默认分一个 未分类的标签
  - 添加记录标题(id)
    - 有写就有, 没有就生成一个唯一uuid
  - 添加的时候支持检索相关记录
    - 支持选择相关记录进行更新
- 记录需要有个单独操作界面
  - 可以修改
    - id
    - 内容
    - 标签
  - 引用会在保存的时候自动刷新
  - 可以删除
    - 如果删除了一条被其他记录引用的记录, 其他记录再点击引用的时候会提示该引用已被删除
  - 一进来就是一个查看格式的界面
    - 显示id, 内容, 标签, 引用, 被引用.
  - 可以通过点击编辑来修改内容与id和标签, 点击保存的时候会自动刷新引用
    - 如果引用已经被删除了, 会提示被删除的引用, 让其是否删除相关引用, 确认保存 或者 取消 用于修改neritic
    - 如果引用的文件或者文件源被删除了, 也会有相关提示
- 记录与记录之间可以选择进行合并
  - 合并的时候, 需要选择一个或者写个新的进行合并, 也可以选择一个新的id
    - 历史引用了合并的记录的id会更新为新的id
- 记录列表
  - 直接显示全部
    - 标签检索
      - 支持正则
    - id检索
    - 内容检索
- 记录树(引用/标签)
  - 可以查看
  - 可以修改(增删改)标签 (引用无法修改)
  - 可以点进记录进行修改与查看与删除,以及合并
- 记录图
  - 与引用树类似, 可以查看与修改标签
- 文件相关
  - 给个文件源界面, 以文件名称作为该列表显示, 会显示被哪些记录引用
    - 可以进行删除, 修改与添加就算了
      - 删除前会提示有哪些记录引用了该文件
    - 会显示文件的上传时间与更新时间, 会显示MD5
    - 支持通过点击相关记录来跳转到对应记录的页面

design:
- 左侧是路由栏, 可以缩回去
- 右侧是内容栏, 根据路由显示相关东西
- 路由栏:
  - 首页: 默认可以选择: 图&树&列表
    - 首次默认显示 列表
  - 添加记录: 添加记录的界面
    - 编辑界面是隐藏的在路由栏看不到
  - 记录列表:
    - 直接显示表单数据
      - 支持单数据操作
        - 修改, 删除
      - 支持批量操作
        - 批量删除
        - 批量合并
    - 显示
      - id
      - 内容 使用markdown格式显示, 而非显示源文件
      - 标签
        - 显示标签包含全路径
          - 大标签/小标签/小X标签
      - 操作
        - 查看 查看就是编辑界面,未开启了编辑操作
        - 修改 编辑界面,开启了编辑操作
        - 删除 如果有被其他记录引用会提示有哪些记录引用了, 是否删除
  - 图:
    - 图节点默认显示
      - 记录节点 显示id
      - 标签节点 显示name
    - 图节点点击后会显示操作
      - 引用节点
        - 查看
        - 修改
        - 删除
      - 标签节点
        - 修改
        - 删除
      - 修改后会重新渲染一次
  - 树: 暂时不实现, 因为循环引用导致树不方便显示
    - 除了显示, 其他与图相同
    - 默认显示深度为3,可以在界面上控制显示深度, 支持修改默认
  - 标签列表:
    - 显示
      - 标签id
      - 标签name
      - 标签描述
    - 操作
      - 删除
        - 会提示相关引用
      - 修改与删除后都会刷新一次
    - 支持批量删除, 点击删除标签的时候, 会提示有哪些记录引用了该标签
    - 重名标签会提示添加失败
  - 源文件列表:
    - 显示
      - 文件名称,包括后缀
        - 支持文件名称搜索
      - 文件创建时间
      - 文件修改时间
        - 因为可能存在文件名称修改
      - 文件是否还存在(可能被用户删除了源文件)
      - 被哪些记录id引用
        - 支持点击该记录跳转到对应记录
      - 操作
        - 删除
          - 删除的时候会提示有哪些引用
        - 修改名称
          - 重名会提示修改操作
            - 修改当前新使用的名称, 避免重复
            - 修改历史重名文件名称
    - 支持批量删除
- 记录界面
  - 查看状态
    - id
    - 内容 markdown格式
    - 标签
    - 引用
    - 被引用
    - 操作
      - 修改
      - 删除
  - 编辑状态
    - id 可以修改
    - 内容 markdown格式 可以修改
    - 标签 可以修改
    - 引用 无法修改, 保存的时候会自动更新
    - 被引用 无法修改
    - 操作
      - 保存
      - 取消
  - 创建状态
    - id 可以修改
    - 内容 markdown格式 可以修改
    - 标签 可以修改
    - 引用 无法修改, 保存的时候会自动更新
    - 被引用 无法修改
    - 操作
      - 保存
      - 取消



technology:
- 业务实例:
  - 记录/record:
    - id:str 用户自定义或者生成uuid
    - content:str markdown的内容
    - quotes:list[str] 引用的recordIds,会从content中解析出来
    - referenceds:list[str] 被引用的recordIds,会从content中解析出来
    - labels:list[label] 标签列表
    - create_time:date
    - update_time:date
  - 文件/file:
    - id:str 文件id uuid
    - name:str 文件名称包括类型 test.png, 不校验类型
    - md5:str  文件生成的md5 使用blake2算法,尽可能避免碰撞 暂时都放一个文件夹
    - quotes:list[record_id] 引用了该源文件的记录id列表
    - create_time:date
    - update_time:date
  - 标签/label:
    - id:str 标签uuid
    - name:str 标签具体名称 基本唯一
    - describe:str 默认为空, 可以在标签树列表进行修改
    - child:list[label] 子标签
    - create_time:date
    - update_time:date
  - 引用图实例: TODO
  - 标签图实例: TODO

- 数据库设计:
  - 记录/record:
    - id:str
    - content:str
    - create_time:date
    - update_time:date
  - 标签/label:
    - id:str
    - name:str
    - describe:str
    - create_time:date
    - update_time:date
  - 记录标签组/record_labels:
    - id:int
    - record:str
    - label:str
    - create_time:date
    - update_time:date
  - 记录引用/record_quote:
    - id:int
    - quote:str 引用id
    - referenced:str 被引用id
    - create_time:date
    - update_time:date
  - 记录文件引用/record_file:
    - id:int
    - quote:str 引用id
    - referenced:str 被引用id
    - create_time:date
    - update_time:date
  - 文件/file:
    - id:str uuid
    - name:str
    - md5:str
    - create_time:date
    - update_time:date
- 配置文件:
  - 文件存储位置/files: str
  - 默认显示/default_show:
    - home: str list/enum{list,chart}
    - chart: str quote/enum{quote,label}

业务逻辑:
1. 获取默认显示配置
2. 记录
   1. 参数分页获取记录列表
   2. 创建记录
   3. 根据记录id修改记录
      1. 在这里可以修改使用的标签组信息
         1. 如果存在就直接使用
         2. 不存在则创建
      2. 在这里可以更新文件引用关系
      3. 在这里可以更新记录引用关系
   4. 根据记录id删除记录
3. 标签
   1. 参数分页获取标签列表
   2. 创建标签
   3. 根据标签id修改标签
   4. 根据标签id删除标签
4. 文件
   1. 上传文件, 并返回对应文件位置
   2. 参数分页获取文件列表
   3. 根据id删除文件
5. 根据类型返回相关图数据

文件相关重新定义一下: 
  1. 文件名称包括后缀不变
  2. 在相同md5的文件会提示是否要使用原有的或者更新名称为新的文件名称
     1. 更新为新的文件名称后, 其他记录引用的文件也同样会修改名称为新文件名
  3. 如果存在相同名称, 不同md5的文件
     1. 会提示有相同名称但是内容不同的文件
     2. 列出相同名称不同md5的记录
     3. 支持打开原有名称的文件打开或者下载
     4. 支持将当前文件更新名称来确保名称不重复来完成导入
     5. 支持将历史文件名更新来确保名称不重复来完成导入

标签重新定义
  1. 删除path
  2. 不用父子标签定义

图不区分引用还是标签,都放一起反正都是连接相关的规则